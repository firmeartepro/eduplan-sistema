<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPlan - Ensino Fundamental 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Carregando EduPlan...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">üìö EduPlan - Fundamental 1</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userName" class="text-gray-700">Carregando...</span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">
                        Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Planejamento para Ensino Fundamental 1</h2>
                    <p class="text-gray-600 mb-6">Gerencie suas disciplinas e planeje suas aulas conforme a BNCC.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="openDisciplinasModal()" class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">üìñ</div>
                            <div class="font-medium">Minhas Disciplinas</div>
                        </button>
                        
                        <button onclick="openNewPlanModal()" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">üìã</div>
                            <div class="font-medium">Nova Aula</div>
                        </button>
                        
                        <button onclick="loadPlans()" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">üìö</div>
                            <div class="font-medium">Minhas Aulas</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div id="contentArea" class="px-4 sm:px-0 mt-6">
            <!-- Content will be loaded here -->
        </div>
    </main>

    <!-- Modal Disciplinas -->
    <div id="disciplinasModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full p-6 max-h-96 overflow-y-auto">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Gerenciar Minhas Disciplinas</h3>
                
                <div class="mb-6">
                    <h4 class="font-medium text-gray-700 mb-3">Disciplinas B√°sicas (BNCC)</h4>
                    <div class="grid grid-cols-2 gap-2" id="disciplinasBasicas">
                        <!-- Ser√° preenchido via JavaScript -->
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="font-medium text-gray-700 mb-3">Disciplinas de Especialistas</h4>
                    <div class="grid grid-cols-2 gap-2" id="disciplinasEspecialistas">
                        <!-- Ser√° preenchido via JavaScript -->
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button onclick="closeDisciplinasModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Plan Modal -->
    <div id="newPlanModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Nova Aula</h3>
                
                <form id="newPlanForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Disciplina</label>
                            <select name="subject" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" id="subjectSelect">
                                <option value="">Selecione uma disciplina</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ano/Turma</label>
                            <select name="class" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                                <option value="">Selecione o ano</option>
                                <option value="1¬∫ ano">1¬∫ ano</option>
                                <option value="2¬∫ ano">2¬∫ ano</option>
                                <option value="3¬∫ ano">3¬∫ ano</option>
                                <option value="4¬∫ ano">4¬∫ ano</option>
                                <option value="5¬∫ ano">5¬∫ ano</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Data</label>
                            <input type="date" name="date" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Quantidade de Aulas</label>
                            <select name="duration" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                                <option value="">Selecione</option>
                                <option value="1">1 hora/aula</option>
                                <option value="2">2 horas/aula</option>
                                <option value="3">3 horas/aula</option>
                                <option value="4">4 horas/aula</option>
                                <option value="5">5 horas/aula</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Habilidades BNCC</label>
                            <select name="habilidade" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" id="habilidadeSelect">
                                <option value="">Selecione uma habilidade</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Conte√∫do/Objetivo</label>
                            <textarea name="content" rows="3" placeholder="Descreva o conte√∫do e objetivos da aula..." class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border"></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" onclick="closeNewPlanModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                            Salvar Aula
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts carregados na ordem correta -->
    <script>
        console.log('=== INICIANDO CARREGAMENTO ===');
        
        // Vari√°veis globais
        let firebase, auth, db;
        
        // Disciplinas da BNCC - Ensino Fundamental 1
        const disciplinasBNCC = {
            basicas: ['L√≠ngua Portuguesa', 'Matem√°tica', 'Ci√™ncias', 'Hist√≥ria', 'Geografia'],
            especialistas: ['Arte', 'Educa√ß√£o F√≠sica', 'Inform√°tica', 'Ingl√™s']
        };
        
        // Habilidades da BNCC por disciplina (principais c√≥digos)
        const habilidadesBNCC = {
            'L√≠ngua Portuguesa': {
                '1¬∫ ano': ['EF01LP01 - Reconhecer que textos s√£o lidos e escritos da esquerda para a direita e de cima para baixo da p√°gina', 'EF01LP02 - Escrever, espontaneamente ou por ditado, palavras e frases de forma alfab√©tica', 'EF01LP03 - Observar escritas convencionais', 'EF01LP04 - Distinguir as letras do alfabeto de outros sinais gr√°ficos', 'EF01LP05 - Reconhecer o sistema de escrita alfab√©tica como representa√ß√£o dos sons da fala'],
                '2¬∫ ano': ['EF02LP01 - Utilizar, ao produzir o texto, grafia correta de palavras conhecidas', 'EF02LP02 - Segmentar palavras em s√≠labas e remover e substituir s√≠labas iniciais', 'EF02LP03 - Ler e escrever palavras com correspond√™ncias regulares diretas', 'EF02LP04 - Ler e escrever corretamente palavras com s√≠labas CV, V, CVC, CCV', 'EF02LP05 - Ler e escrever corretamente palavras com marcas de nasalidade'],
                '3¬∫ ano': ['EF03LP01 - Ler e escrever palavras com correspond√™ncias regulares contextuais', 'EF03LP02 - Ler e escrever corretamente palavras com s√≠labas CV, V, CVC, CCV, VC, VV, CVV', 'EF03LP03 - Ler e escrever corretamente palavras com os d√≠grafos lh, nh, ch', 'EF03LP04 - Usar acento gr√°fico (agudo ou circunflexo) em monoss√≠labos t√¥nicos', 'EF03LP05 - Identificar o n√∫mero de s√≠labas de palavras'],
                '4¬∫ ano': ['EF04LP01 - Grafar palavras utilizando regras de correspond√™ncia fonema-grafema regulares', 'EF04LP02 - Ler e escrever, corretamente, palavras com s√≠labas VV e CVV em casos nos quais a combina√ß√£o VV (ditongo) √© reduzida na l√≠ngua oral', 'EF04LP03 - Localizar palavras no dicion√°rio para esclarecer significados', 'EF04LP04 - Usar acento gr√°fico (agudo ou circunflexo) em parox√≠tonas terminadas em -i(s), -l, -n, -r, -√£o(s)', 'EF04LP05 - Identificar a fun√ß√£o na leitura e usar, adequadamente, na escrita ponto final, de interroga√ß√£o, de exclama√ß√£o, dois-pontos e travess√£o'],
                '5¬∫ ano': ['EF05LP01 - Grafar palavras utilizando regras de correspond√™ncia fonema-grafema regulares, contextuais e morfol√≥gicas', 'EF05LP02 - Identificar o car√°ter poliss√™mico das palavras (uma mesma palavra com diferentes significados)', 'EF05LP03 - Acentuar corretamente palavras ox√≠tonas, parox√≠tonas e proparox√≠tonas', 'EF05LP04 - Diferenciar, na leitura de textos, v√≠rgula, ponto e v√≠rgula, dois-pontos e reconhecer, na leitura de textos, o efeito de sentido que decorre do uso de retic√™ncias, aspas, par√™nteses', 'EF05LP05 - Identificar a express√£o de presente, passado e futuro em tempos verbais do modo indicativo']
            },
            'Matem√°tica': {
                '1¬∫ ano': ['EF01MA01 - Utilizar n√∫meros naturais como indicador de quantidade ou de ordem em diferentes situa√ß√µes cotidianas', 'EF01MA02 - Contar de maneira exata ou aproximada, utilizando diferentes estrat√©gias', 'EF01MA03 - Estimar e comparar quantidades de objetos de dois conjuntos', 'EF01MA04 - Contar a quantidade de objetos de cole√ß√µes at√© 100 unidades', 'EF01MA05 - Comparar n√∫meros naturais de at√© duas ordens em situa√ß√µes cotidianas'],
                '2¬∫ ano': ['EF02MA01 - Comparar e ordenar n√∫meros naturais (at√© a ordem de centenas)', 'EF02MA02 - Fazer estimativas por meio de estrat√©gias diversas a respeito da quantidade de objetos de cole√ß√µes', 'EF02MA03 - Comparar quantidades de objetos de dois conjuntos, por estimativa e/ou por correspond√™ncia', 'EF02MA04 - Compor e decompor n√∫meros naturais de at√© tr√™s ordens', 'EF02MA05 - Construir fatos b√°sicos da adi√ß√£o e utiliz√°-los em procedimentos de c√°lculo para resolver problemas'],
                '3¬∫ ano': ['EF03MA01 - Ler, escrever e comparar n√∫meros naturais de at√© a ordem de unidade de milhar', 'EF03MA02 - Identificar caracter√≠sticas do sistema de numera√ß√£o decimal', 'EF03MA03 - Construir e utilizar fatos b√°sicos da adi√ß√£o e da subtra√ß√£o para o c√°lculo mental ou escrito', 'EF03MA04 - Estabelecer a rela√ß√£o entre n√∫meros naturais e pontos da reta num√©rica para utiliz√°-la na ordena√ß√£o dos n√∫meros naturais', 'EF03MA05 - Utilizar diferentes procedimentos de c√°lculo mental e escrito para resolver problemas significativos envolvendo adi√ß√£o e subtra√ß√£o'],
                '4¬∫ ano': ['EF04MA01 - Ler, escrever e ordenar n√∫meros naturais at√© a ordem de dezenas de milhar', 'EF04MA02 - Mostrar, por decomposi√ß√£o e composi√ß√£o, que todo n√∫mero natural pode ser escrito por meio de adi√ß√µes e multiplica√ß√µes por pot√™ncias de dez', 'EF04MA03 - Resolver e elaborar problemas com n√∫meros naturais envolvendo adi√ß√£o e subtra√ß√£o', 'EF04MA04 - Utilizar as rela√ß√µes entre adi√ß√£o e subtra√ß√£o, bem como entre multiplica√ß√£o e divis√£o, para ampliar as estrat√©gias de c√°lculo', 'EF04MA05 - Utilizar as propriedades das opera√ß√µes para desenvolver estrat√©gias de c√°lculo'],
                '5¬∫ ano': ['EF05MA01 - Ler, escrever e ordenar n√∫meros naturais at√© a ordem das centenas de milhar com compreens√£o das principais caracter√≠sticas do sistema de numera√ß√£o decimal', 'EF05MA02 - Ler, escrever e ordenar n√∫meros racionais na forma decimal com compreens√£o das principais caracter√≠sticas do sistema de numera√ß√£o decimal', 'EF05MA03 - Identificar e representar fra√ß√µes (menores e maiores que a unidade), associando-as ao resultado de uma divis√£o ou √† ideia de parte de um todo', 'EF05MA04 - Identificar fra√ß√µes equivalentes', 'EF05MA05 - Comparar e ordenar n√∫meros racionais positivos (representa√ß√µes fracion√°ria e decimal)']
            },
            'Ci√™ncias': {
                '1¬∫ ano': ['EF01CI01 - Comparar caracter√≠sticas de diferentes materiais presentes em objetos de uso cotidiano', 'EF01CI02 - Localizar, nomear e representar graficamente (por meio de desenhos) partes do corpo humano', 'EF01CI03 - Discutir as raz√µes pelas quais os h√°bitos de higiene do corpo s√£o necess√°rios para a manuten√ß√£o da sa√∫de', 'EF01CI04 - Comparar caracter√≠sticas f√≠sicas entre os colegas, reconhecendo a diversidade e a import√¢ncia da valoriza√ß√£o, do acolhimento e do respeito √†s diferen√ßas', 'EF01CI05 - Identificar e nomear diferentes escalas de tempo: os per√≠odos di√°rios (manh√£, tarde, noite) e a sucess√£o de dias, semanas, meses e anos'],
                '2¬∫ ano': ['EF02CI01 - Identificar de que materiais (metais, madeira, vidro etc.) s√£o feitos os objetos que fazem parte da vida cotidiana', 'EF02CI02 - Propor o uso de diferentes materiais para a constru√ß√£o de objetos de uso cotidiano', 'EF02CI03 - Discutir os cuidados necess√°rios √† preven√ß√£o de acidentes dom√©sticos (objetos cortantes e inflam√°veis, eletricidade, produtos de limpeza, medicamentos etc.)', 'EF02CI04 - Descrever caracter√≠sticas de plantas e animais (tamanho, forma, cor, fase da vida, local onde se desenvolvem etc.)', 'EF02CI05 - Investigar a import√¢ncia da √°gua e da luz para a manuten√ß√£o da vida de plantas em geral'],
                '3¬∫ ano': ['EF03CI01 - Produzir diferentes sons a partir da vibra√ß√£o de variados objetos e identificar vari√°veis que influem nesse fen√¥meno', 'EF03CI02 - Experimentar e relatar o que ocorre com a passagem da luz atrav√©s de objetos transparentes (copos, janelas de vidro, lentes, prismas, √°gua etc.), no contato com superf√≠cies polidas (espelhos) e na intersec√ß√£o com objetos opacos (paredes, pratos, pessoas e outros objetos de uso cotidiano)', 'EF03CI03 - Discutir h√°bitos necess√°rios para a manuten√ß√£o da sa√∫de auditiva e visual considerando as condi√ß√µes do ambiente em que vive', 'EF03CI04 - Identificar caracter√≠sticas sobre o modo de vida (o que comem, como se reproduzem, como se deslocam etc.) dos animais mais comuns no ambiente pr√≥ximo', 'EF03CI05 - Descrever e comunicar as altera√ß√µes que ocorrem desde o nascimento em animais de diferentes meios terrestres ou aqu√°ticos, inclusive o homem'],
                '4¬∫ ano': ['EF04CI01 - Identificar misturas na vida di√°ria, com base em suas propriedades f√≠sicas observ√°veis', 'EF04CI02 - Testar e relatar transforma√ß√µes nos materiais do dia a dia quando expostos a diferentes condi√ß√µes (aquecimento, resfriamento, luz e umidade)', 'EF04CI03 - Concluir que algumas mudan√ßas causadas por aquecimento ou resfriamento s√£o revers√≠veis (como as mudan√ßas de estado f√≠sico da √°gua) e outras n√£o (como o cozimento do ovo, a queima do papel etc.)', 'EF04CI04 - Analisar e construir cadeias alimentares simples, reconhecendo a posi√ß√£o ocupada pelos seres vivos nessas cadeias e o papel do Sol como fonte prim√°ria de energia na produ√ß√£o de alimentos', 'EF04CI05 - Descrever e destacar semelhan√ßas e diferen√ßas entre o ciclo da mat√©ria e o fluxo de energia entre os componentes vivos e n√£o vivos de um ecossistema'],
                '5¬∫ ano': ['EF05CI01 - Explorar fen√¥menos da vida cotidiana que evidenciem propriedades f√≠sicas dos materiais ‚Äì como densidade, condutibilidade t√©rmica e el√©trica, magnetismo, dureza, elasticidade etc.', 'EF05CI02 - Aplicar os conhecimentos sobre as mudan√ßas de estado f√≠sico da √°gua para explicar o ciclo hidrol√≥gico', 'EF05CI03 - Selecionar argumentos que justifiquem a import√¢ncia da cobertura vegetal para a manuten√ß√£o do ciclo da √°gua, a conserva√ß√£o dos solos, dos cursos de √°gua e da qualidade do ar atmosf√©rico', 'EF05CI04 - Identificar os principais usos da √°gua e de outros materiais nas atividades cotidianas para discutir e propor formas sustent√°veis de utiliza√ß√£o desses recursos', 'EF05CI05 - Construir propostas coletivas para um consumo mais consciente e criar solu√ß√µes tecnol√≥gicas para o descarte adequado e a reutiliza√ß√£o ou reciclagem de materiais consumidos na escola e/ou na vida cotidiana']
            },
            'Hist√≥ria': {
                '1¬∫ ano': ['EF01HI01 - Identificar aspectos do seu crescimento por meio do registro das lembran√ßas particulares ou de lembran√ßas dos membros de sua fam√≠lia e/ou de sua comunidade', 'EF01HI02 - Identificar a rela√ß√£o entre as suas hist√≥rias e as hist√≥rias de sua fam√≠lia e de sua comunidade', 'EF01HI03 - Descrever e distinguir os seus pap√©is e responsabilidades relacionados √† fam√≠lia, √† escola e √† comunidade', 'EF01HI04 - Identificar as diferen√ßas entre os variados ambientes em que vive (dom√©stico, escolar e da comunidade), reconhecendo as especificidades dos h√°bitos e das regras que os regem', 'EF01HI05 - Identificar semelhan√ßas e diferen√ßas entre jogos e brincadeiras atuais e de outras √©pocas e lugares'],
                '2¬∫ ano': ['EF02HI01 - Reconhecer espa√ßos de sociabilidade e identificar os motivos que aproximam e separam as pessoas em diferentes grupos sociais ou de parentesco', 'EF02HI02 - Identificar e descrever pr√°ticas e pap√©is sociais que as pessoas exercem em diferentes comunidades', 'EF02HI03 - Selecionar situa√ß√µes cotidianas que remetam √† percep√ß√£o de mudan√ßa, pertencimento e mem√≥ria', 'EF02HI04 - Selecionar e compreender o significado de objetos e documentos pessoais como fontes de mem√≥rias e hist√≥rias nos √¢mbitos pessoal, familiar, escolar e comunit√°rio', 'EF02HI05 - Selecionar objetos e documentos pessoais e de grupos pr√≥ximos ao seu conv√≠vio e compreender sua fun√ß√£o, seu uso e seu significado'],
                '3¬∫ ano': ['EF03HI01 - Identificar os grupos populacionais que formam a cidade, o munic√≠pio e a regi√£o, as rela√ß√µes estabelecidas entre eles e os eventos que marcam a forma√ß√£o da cidade', 'EF03HI02 - Selecionar, por meio da consulta de fontes de diferentes naturezas, e registrar acontecimentos ocorridos ao longo do tempo na cidade ou regi√£o em que vive', 'EF03HI03 - Identificar e comparar pontos de vista em rela√ß√£o a eventos significativos do local em que vive, aspectos relacionados a condi√ß√µes sociais e √† presen√ßa de diferentes grupos sociais e culturais', 'EF03HI04 - Identificar os patrim√¥nios hist√≥ricos e culturais de sua cidade ou regi√£o e discutir as raz√µes culturais, sociais e pol√≠ticas para que assim sejam considerados', 'EF03HI05 - Identificar os marcos hist√≥ricos do lugar em que vive e compreender seus significados'],
                '4¬∫ ano': ['EF04HI01 - Reconhecer a hist√≥ria como resultado da a√ß√£o do ser humano no tempo e no espa√ßo, com base na identifica√ß√£o de mudan√ßas e perman√™ncias ao longo do tempo', 'EF04HI02 - Identificar mudan√ßas e perman√™ncias ao longo do tempo, discutindo os sentidos dos grandes marcos da hist√≥ria da humanidade', 'EF04HI03 - Identificar as transforma√ß√µes ocorridas na cidade ao longo do tempo e discutir suas interfer√™ncias nos modos de vida de seus habitantes', 'EF04HI04 - Identificar as rela√ß√µes entre os indiv√≠duos e a natureza e discutir o significado do nomadismo e da fixa√ß√£o das primeiras comunidades humanas', 'EF04HI05 - Relacionar os processos de ocupa√ß√£o do campo a interven√ß√µes na natureza, avaliando os resultados dessas interven√ß√µes'],
                '5¬∫ ano': ['EF05HI01 - Identificar os processos de forma√ß√£o das culturas e dos povos, relacionando-os com o espa√ßo geogr√°fico ocupado', 'EF05HI02 - Identificar os mecanismos de organiza√ß√£o do poder pol√≠tico com vistas √† compreens√£o da ideia de Estado e/ou de outras formas de ordena√ß√£o social', 'EF05HI03 - Analisar o papel das culturas e das religi√µes na composi√ß√£o identit√°ria dos povos antigos', 'EF05HI04 - Associar a no√ß√£o de cidadania com os princ√≠pios de respeito √† diversidade, √† pluralidade e aos direitos humanos', 'EF05HI05 - Associar o conceito de cidadania √† conquista de direitos dos povos e das sociedades, compreendendo-o como conquista hist√≥rica']
            },
            'Geografia': {
                '1¬∫ ano': ['EF01GE01 - Descrever caracter√≠sticas observadas de seus lugares de viv√™ncia (moradia, escola etc.) e identificar semelhan√ßas e diferen√ßas entre esses lugares', 'EF01GE02 - Identificar semelhan√ßas e diferen√ßas entre jogos e brincadeiras de diferentes √©pocas e lugares', 'EF01GE03 - Identificar e relatar semelhan√ßas e diferen√ßas de usos do espa√ßo p√∫blico (pra√ßas, parques) para o lazer e diferentes manifesta√ß√µes', 'EF01GE04 - Discutir e elaborar, coletivamente, regras de conv√≠vio em diferentes espa√ßos (sala de aula, escola etc.)', 'EF01GE05 - Observar e descrever ritmos naturais (dia e noite, varia√ß√£o de temperatura e umidade etc.) em diferentes escalas espaciais e temporais'],
                '2¬∫ ano': ['EF02GE01 - Descrever a hist√≥ria das migra√ß√µes no bairro ou comunidade em que vive', 'EF02GE02 - Comparar costumes e tradi√ß√µes de diferentes popula√ß√µes inseridas no bairro ou comunidade em que vive', 'EF02GE03 - Comparar diferentes meios de transporte e de comunica√ß√£o, indicando o seu papel na conex√£o entre lugares', 'EF02GE04 - Reconhecer semelhan√ßas e diferen√ßas nos h√°bitos, nas rela√ß√µes com a natureza e no modo de viver de pessoas em diferentes lugares', 'EF02GE05 - Analisar mudan√ßas de paisagens urbanas ao longo do tempo, comparando imagens de um mesmo lugar em diferentes momentos'],
                '3¬∫ ano': ['EF03GE01 - Identificar e comparar aspectos culturais dos grupos sociais de seus lugares de viv√™ncia', 'EF03GE02 - Identificar, em seus lugares de viv√™ncia, marcas de contribui√ß√£o cultural e econ√¥mica de grupos de diferentes origens', 'EF03GE03 - Reconhecer os diferentes modos de vida de povos e comunidades tradicionais em distintos lugares', 'EF03GE04 - Explicar como os processos naturais e hist√≥ricos atuam na forma√ß√£o e na mudan√ßa das paisagens naturais e antr√≥picas nos seus lugares de viv√™ncia', 'EF03GE05 - Identificar alimentos, minerais e outros produtos cultivados e extra√≠dos da natureza, comparando as atividades de trabalho em diferentes lugares'],
                '4¬∫ ano': ['EF04GE01 - Selecionar, em seus lugares de viv√™ncia e em suas hist√≥rias familiares, elementos de distintas culturas (ind√≠genas, afro-brasileiras, de outras regi√µes do pa√≠s, latino-americanas, europeias, asi√°ticas etc.)', 'EF04GE02 - Descrever processos migrat√≥rios e suas contribui√ß√µes para a forma√ß√£o da sociedade brasileira', 'EF04GE03 - Distinguir fun√ß√µes e pap√©is dos √≥rg√£os do poder p√∫blico e canais de participa√ß√£o social na gest√£o do Munic√≠pio', 'EF04GE04 - Reconhecer especificidades e analisar a interdepend√™ncia do campo e da cidade, considerando fluxos econ√¥micos, de informa√ß√µes, de ideias e de pessoas', 'EF04GE05 - Distinguir unidades pol√≠tico-administrativas oficiais nacionais (Distrito, Munic√≠pio, Unidade da Federa√ß√£o e grande regi√£o), suas fronteiras e sua hierarquia'],
                '5¬∫ ano': ['EF05GE01 - Descrever e analisar din√¢micas populacionais na Unidade da Federa√ß√£o em que vive, estabelecendo rela√ß√µes entre migra√ß√µes e condi√ß√µes de infraestrutura', 'EF05GE02 - Identificar diferen√ßas √©tnico-raciais e √©tnico-culturais e desigualdades sociais entre grupos em diferentes territ√≥rios', 'EF05GE03 - Identificar as formas e fun√ß√µes das cidades e analisar as mudan√ßas sociais, econ√¥micas e ambientais provocadas pelo seu crescimento', 'EF05GE04 - Reconhecer as caracter√≠sticas da cidade e analisar as intera√ß√µes entre a cidade e o campo e entre cidades na rede urbana', 'EF05GE05 - Identificar e comparar as mudan√ßas dos tipos de trabalho e desenvolvimento tecnol√≥gico na agropecu√°ria, na ind√∫stria, no com√©rcio e nos servi√ßos']
            },
            'Arte': {
                '1¬∫ ano': ['EF01AR01 - Identificar e apreciar formas distintas das artes visuais tradicionais e contempor√¢neas', 'EF01AR02 - Explorar e reconhecer elementos constitutivos das artes visuais (ponto, linha, forma, cor, espa√ßo, movimento etc.)', 'EF01AR03 - Reconhecer e analisar a influ√™ncia de distintas matrizes est√©ticas e culturais das artes visuais nas manifesta√ß√µes art√≠sticas das culturas locais, regionais e nacionais', 'EF01AR04 - Experimentar diferentes formas de express√£o art√≠stica (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instala√ß√£o, v√≠deo, fotografia etc.)', 'EF01AR05 - Experimentar a cria√ß√£o em artes visuais de modo individual, coletivo e colaborativo'],
                '2¬∫ ano': ['EF02AR01 - Reconhecer e apreciar formas distintas das artes visuais tradicionais e contempor√¢neas', 'EF02AR02 - Explorar e reconhecer elementos constitutivos das artes visuais (ponto, linha, forma, cor, espa√ßo, movimento etc.)', 'EF02AR03 - Reconhecer e analisar a influ√™ncia de distintas matrizes est√©ticas e culturais das artes visuais nas manifesta√ß√µes art√≠sticas das culturas locais, regionais e nacionais', 'EF02AR04 - Experimentar diferentes formas de express√£o art√≠stica (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instala√ß√£o, v√≠deo, fotografia etc.)', 'EF02AR05 - Experimentar a cria√ß√£o em artes visuais de modo individual, coletivo e colaborativo'],
                '3¬∫ ano': ['EF03AR01 - Identificar e apreciar formas distintas das artes visuais tradicionais e contempor√¢neas', 'EF03AR02 - Identificar e analisar elementos constitutivos das artes visuais (ponto, linha, forma, cor, espa√ßo, movimento etc.)', 'EF03AR03 - Reconhecer e analisar a influ√™ncia de distintas matrizes est√©ticas e culturais das artes visuais nas manifesta√ß√µes art√≠sticas das culturas locais, regionais e nacionais', 'EF03AR04 - Experimentar diferentes formas de express√£o art√≠stica (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instala√ß√£o, v√≠deo, fotografia etc.)', 'EF03AR05 - Experimentar a cria√ß√£o em artes visuais de modo individual, coletivo e colaborativo'],
                '4¬∫ ano': ['EF04AR01 - Identificar e apreciar formas distintas das artes visuais tradicionais e contempor√¢neas', 'EF04AR02 - Identificar e analisar elementos constitutivos das artes visuais (ponto, linha, forma, cor, espa√ßo, movimento etc.)', 'EF04AR03 - Reconhecer e analisar a influ√™ncia de distintas matrizes est√©ticas e culturais das artes visuais nas manifesta√ß√µes art√≠sticas das culturas locais, regionais e nacionais', 'EF04AR04 - Experimentar diferentes formas de express√£o art√≠stica (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instala√ß√£o, v√≠deo, fotografia etc.)', 'EF04AR05 - Experimentar a cria√ß√£o em artes visuais de modo individual, coletivo e colaborativo'],
                '5¬∫ ano': ['EF05AR01 - Identificar e apreciar formas distintas das artes visuais tradicionais e contempor√¢neas', 'EF05AR02 - Identificar e analisar elementos constitutivos das artes visuais (ponto, linha, forma, cor, espa√ßo, movimento etc.)', 'EF05AR03 - Reconhecer e analisar a influ√™ncia de distintas matrizes est√©ticas e culturais das artes visuais nas manifesta√ß√µes art√≠sticas das culturas locais, regionais e nacionais', 'EF05AR04 - Experimentar diferentes formas de express√£o art√≠stica (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instala√ß√£o, v√≠deo, fotografia etc.)', 'EF05AR05 - Experimentar a cria√ß√£o em artes visuais de modo individual, coletivo e colaborativo']
            },
            'Educa√ß√£o F√≠sica': {
                '1¬∫ ano': ['EF01EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunit√°rio e regional', 'EF01EF02 - Explicar, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunit√°rio e regional', 'EF01EF03 - Descrever, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz ind√≠gena e africana', 'EF01EF04 - Colaborar na proposi√ß√£o e na produ√ß√£o de alternativas para a pr√°tica, em outros momentos e espa√ßos, de brincadeiras e jogos e demais pr√°ticas corporais tematizadas na escola', 'EF01EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a pr√°tica de esportes de marca e de precis√£o'],
                '2¬∫ ano': ['EF02EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunit√°rio e regional', 'EF02EF02 - Explicar, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunit√°rio e regional', 'EF02EF03 - Descrever, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz ind√≠gena e africana', 'EF02EF04 - Colaborar na proposi√ß√£o e na produ√ß√£o de alternativas para a pr√°tica, em outros momentos e espa√ßos, de brincadeiras e jogos e demais pr√°ticas corporais tematizadas na escola', 'EF02EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a pr√°tica de esportes de marca e de precis√£o'],
                '3¬∫ ano': ['EF03EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunit√°rio e regional', 'EF03EF02 - Explicar, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunit√°rio e regional', 'EF03EF03 - Descrever, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz ind√≠gena e africana', 'EF03EF04 - Colaborar na proposi√ß√£o e na produ√ß√£o de alternativas para a pr√°tica, em outros momentos e espa√ßos, de brincadeiras e jogos e demais pr√°ticas corporais tematizadas na escola', 'EF03EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a pr√°tica de esportes de marca e de precis√£o'],
                '4¬∫ ano': ['EF04EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunit√°rio e regional', 'EF04EF02 - Explicar, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunit√°rio e regional', 'EF04EF03 - Descrever, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz ind√≠gena e africana', 'EF04EF04 - Colaborar na proposi√ß√£o e na produ√ß√£o de alternativas para a pr√°tica, em outros momentos e espa√ßos, de brincadeiras e jogos e demais pr√°ticas corporais tematizadas na escola', 'EF04EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a pr√°tica de esportes de marca e de precis√£o'],
                '5¬∫ ano': ['EF05EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunit√°rio e regional', 'EF05EF02 - Explicar, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunit√°rio e regional', 'EF05EF03 - Descrever, por meio de m√∫ltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz ind√≠gena e africana', 'EF05EF04 - Colaborar na proposi√ß√£o e na produ√ß√£o de alternativas para a pr√°tica, em outros momentos e espa√ßos, de brincadeiras e jogos e demais pr√°ticas corporais tematizadas na escola', 'EF05EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a pr√°tica de esportes de marca e de precis√£o']
            },
            'Ingl√™s': {
                '1¬∫ ano': ['EF01LI01 - Interagir por meio de cumprimentos, utilizando a l√≠ngua inglesa para se comunicar', 'EF01LI02 - Conhecer a si e ao outro por meio de repert√≥rio relativo a dados pessoais', 'EF01LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informa√ß√µes do contexto escolar', 'EF01LI04 - Reconhecer o ingl√™s como l√≠ngua franca, identificando o seu uso no cotidiano', 'EF01LI05 - Conhecer diferentes pa√≠ses que t√™m o ingl√™s como l√≠ngua materna e/ou oficial'],
                '2¬∫ ano': ['EF02LI01 - Interagir por meio de cumprimentos, utilizando a l√≠ngua inglesa para se comunicar', 'EF02LI02 - Conhecer a si e ao outro por meio de repert√≥rio relativo a dados pessoais', 'EF02LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informa√ß√µes do contexto escolar', 'EF02LI04 - Reconhecer o ingl√™s como l√≠ngua franca, identificando o seu uso no cotidiano', 'EF02LI05 - Conhecer diferentes pa√≠ses que t√™m o ingl√™s como l√≠ngua materna e/ou oficial'],
                '3¬∫ ano': ['EF03LI01 - Cumprimentar, apresentar-se e despedir-se, utilizando a l√≠ngua inglesa para se comunicar', 'EF03LI02 - Coletar informa√ß√µes do grupo, perguntando e respondendo sobre a fam√≠lia, os amigos, a escola e a comunidade', 'EF03LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informa√ß√µes do contexto escolar', 'EF03LI04 - Reconhecer o ingl√™s como l√≠ngua franca, identificando o seu uso no cotidiano', 'EF03LI05 - Conhecer diferentes pa√≠ses que t√™m o ingl√™s como l√≠ngua materna e/ou oficial'],
                '4¬∫ ano': ['EF04LI01 - Cumprimentar, apresentar-se e despedir-se, utilizando a l√≠ngua inglesa para se comunicar', 'EF04LI02 - Coletar informa√ß√µes do grupo, perguntando e respondendo sobre a fam√≠lia, os amigos, a escola e a comunidade', 'EF04LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informa√ß√µes do contexto escolar', 'EF04LI04 - Reconhecer o ingl√™s como l√≠ngua franca, identificando o seu uso no cotidiano', 'EF04LI05 - Conhecer diferentes pa√≠ses que t√™m o ingl√™s como l√≠ngua materna e/ou oficial'],
                '5¬∫ ano': ['EF05LI01 - Participar de conversas, utilizando estrat√©gias para se fazer entender', 'EF05LI02 - Coletar informa√ß√µes do grupo, perguntando e respondendo sobre a fam√≠lia, os amigos, a escola e a comunidade', 'EF05LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informa√ß√µes do contexto escolar', 'EF05LI04 - Reconhecer o ingl√™s como l√≠ngua franca, identificando o seu uso no cotidiano', 'EF05LI05 - Conhecer diferentes pa√≠ses que t√™m o ingl√™s como l√≠ngua materna e/ou oficial']
            },
            'Inform√°tica': {
                '1¬∫ ano': ['Conceitos b√°sicos de inform√°tica', 'Uso correto do mouse e teclado', 'Desenho e pintura digital', 'Jogos educativos simples', 'Cuidados com equipamentos'],
                '2¬∫ ano': ['Navega√ß√£o b√°sica em programas', 'Cria√ß√£o de textos simples', 'Uso de programas educativos', 'Pesquisa orientada na internet', 'Seguran√ßa digital b√°sica'],
                '3¬∫ ano': ['Editor de texto b√°sico', 'Apresenta√ß√µes simples', 'Internet segura', 'Projetos digitais colaborativos', 'Organiza√ß√£o de arquivos'],
                '4¬∫ ano': ['Planilhas b√°sicas', 'Pesquisa e sele√ß√£o de informa√ß√µes', 'Cria√ß√£o de conte√∫do digital', 'Pensamento computacional', '√âtica digital'],
                '5¬∫ ano': ['Programa√ß√£o b√°sica (Scratch)', 'Projetos multim√≠dia', 'Cidadania digital', 'Resolu√ß√£o de problemas com tecnologia', 'Inova√ß√£o e criatividade digital']
            }
        };
        
        // Fun√ß√£o para carregar scripts em ordem
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Carregar Firebase em ordem
        async function initializeFirebase() {
            try {
                console.log('1. Carregando Firebase App...');
                await loadScript('https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js');
                
                console.log('2. Carregando Firebase Auth...');
                await loadScript('https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js');
                
                console.log('3. Carregando Firebase Firestore...');
                await loadScript('https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js');
                
                console.log('4. Inicializando Firebase...');
                const firebaseConfig = {
                    apiKey: "AIzaSyBqJJcT8fX9wLqKoOoN8pMzQvGxHjKjY8E",
                    authDomain: "eduplan-b5d94.firebaseapp.com",
                    projectId: "eduplan-b5d94",
                    storageBucket: "eduplan-b5d94.firebasestorage.app",
                    messagingSenderId: "590470983307",
                    appId: "1:590470983307:web:7c8a4b5d9e2f1a3b4c5d6e"
                };
                
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                console.log('5. Firebase inicializado com sucesso!');
                
                // Configurar observer de autentica√ß√£o
                auth.onAuthStateChanged(function(user) {
                    console.log('Auth state changed:', user ? 'logado' : 'n√£o logado');
                    
                    if (user) {
                        console.log('Usu√°rio logado:', user.email);
                        console.log('Display Name:', user.displayName);
                        console.log('Todos os dados do usu√°rio:', user);
                        
                        // Usar o nome real do Firebase ou email como fallback
                        const userName = user.displayName || user.email.split('@')[0];
                        document.getElementById('userName').textContent = userName;
                        document.getElementById('loadingScreen').style.display = 'none';
                        
                        // Carregar disciplinas do usu√°rio
                        loadUserSubjects();
                    } else {
                        console.log('Usu√°rio n√£o logado, redirecionando...');
                        window.location.href = 'index.html';
                    }
                });
                
            } catch (error) {
                console.error('Erro ao carregar Firebase:', error);
                document.getElementById('loadingScreen').innerHTML = `
                    <div class="text-center">
                        <div class="text-red-500 text-4xl mb-4">‚ùå</div>
                        <p class="text-red-600">Erro ao carregar Firebase</p>
                        <button onclick="location.reload()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded">
                            Tentar novamente
                        </button>
                    </div>
                `;
            }
        }
        
        // Carregar disciplinas do usu√°rio
        async function loadUserSubjects() {
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                const doc = await db.collection('userSubjects').doc(user.uid).get();
                let userSubjects = [];
                
                if (doc.exists) {
                    userSubjects = doc.data().subjects || [];
                }
                
                // Atualizar select de disciplinas no formul√°rio
                updateSubjectSelect(userSubjects);
                
            } catch (error) {
                console.error('Erro ao carregar disciplinas:', error);
            }
        }
        
        // Atualizar select de disciplinas
        function updateSubjectSelect(userSubjects) {
            const select = document.getElementById('subjectSelect');
            select.innerHTML = '<option value="">Selecione uma disciplina</option>';
            
            userSubjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                select.appendChild(option);
            });
        }
        
        // Modal de disciplinas
        function openDisciplinasModal() {
            console.log('Abrindo modal de disciplinas');
            loadDisciplinasModal();
            document.getElementById('disciplinasModal').classList.remove('hidden');
        }

        function closeDisciplinasModal() {
            console.log('Fechando modal de disciplinas');
            document.getElementById('disciplinasModal').classList.add('hidden');
        }
        
        // Carregar disciplinas no modal
        async function loadDisciplinasModal() {
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                // Buscar disciplinas do usu√°rio
                const doc = await db.collection('userSubjects').doc(user.uid).get();
                let userSubjects = [];
                
                if (doc.exists) {
                    userSubjects = doc.data().subjects || [];
                }
                
                // Preencher disciplinas b√°sicas
                const basicasContainer = document.getElementById('disciplinasBasicas');
                basicasContainer.innerHTML = '';
                
                disciplinasBNCC.basicas.forEach(disciplina => {
                    const isSelected = userSubjects.includes(disciplina);
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <label class="flex items-center space-x-2 p-2 border rounded ${isSelected ? 'bg-blue-50 border-blue-300' : 'border-gray-300'}">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSubject('${disciplina}')" class="rounded">
                            <span class="text-sm">${disciplina}</span>
                        </label>
                    `;
                    basicasContainer.appendChild(div);
                });
                
                // Preencher disciplinas de especialistas
                const especialistasContainer = document.getElementById('disciplinasEspecialistas');
                especialistasContainer.innerHTML = '';
                
                disciplinasBNCC.especialistas.forEach(disciplina => {
                    const isSelected = userSubjects.includes(disciplina);
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <label class="flex items-center space-x-2 p-2 border rounded ${isSelected ? 'bg-blue-50 border-blue-300' : 'border-gray-300'}">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSubject('${disciplina}')" class="rounded">
                            <span class="text-sm">${disciplina}</span>
                        </label>
                    `;
                    especialistasContainer.appendChild(div);
                });
                
            } catch (error) {
                console.error('Erro ao carregar disciplinas do modal:', error);
            }
        }
        
        // Toggle disciplina
        async function toggleSubject(disciplina) {
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                // Buscar disciplinas atuais
                const doc = await db.collection('userSubjects').doc(user.uid).get();
                let userSubjects = [];
                
                if (doc.exists) {
                    userSubjects = doc.data().subjects || [];
                }
                
                // Toggle disciplina
                if (userSubjects.includes(disciplina)) {
                    userSubjects = userSubjects.filter(s => s !== disciplina);
                } else {
                    userSubjects.push(disciplina);
                }
                
                // Salvar no Firebase
                await db.collection('userSubjects').doc(user.uid).set({
                    subjects: userSubjects,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Atualizar select do formul√°rio
                updateSubjectSelect(userSubjects);
                
                console.log('Disciplinas atualizadas:', userSubjects);
                
            } catch (error) {
                console.error('Erro ao atualizar disciplina:', error);
                alert('Erro ao atualizar disciplina: ' + error.message);
            }
        }
        
        // Modal de nova aula
        function openNewPlanModal() {
            console.log('Abrindo modal de nova aula');
            document.getElementById('newPlanModal').classList.remove('hidden');
        }

        function closeNewPlanModal() {
            console.log('Fechando modal de nova aula');
            document.getElementById('newPlanModal').classList.add('hidden');
            document.getElementById('newPlanForm').reset();
            document.getElementById('habilidadeSelect').innerHTML = '<option value="">Selecione uma habilidade</option>';
        }
        
        // Atualizar habilidades quando disciplina ou ano mudar
        document.addEventListener('DOMContentLoaded', function() {
            const subjectSelect = document.getElementById('subjectSelect');
            const classSelect = document.querySelector('select[name="class"]');
            const habilidadeSelect = document.getElementById('habilidadeSelect');
            
            function updateHabilidades() {
                const subject = subjectSelect.value;
                const classYear = classSelect.value;
                
                habilidadeSelect.innerHTML = '<option value="">Selecione uma habilidade</option>';
                
                if (subject && classYear && habilidadesBNCC[subject] && habilidadesBNCC[subject][classYear]) {
                    habilidadesBNCC[subject][classYear].forEach(habilidade => {
                        const option = document.createElement('option');
                        option.value = habilidade;
                        option.textContent = habilidade;
                        habilidadeSelect.appendChild(option);
                    });
                }
            }
            
            if (subjectSelect && classSelect) {
                subjectSelect.addEventListener('change', updateHabilidades);
                classSelect.addEventListener('change', updateHabilidades);
            }
        });

        // Salvar aula
        async function saveLessonPlan(planData) {
            console.log('Salvando aula:', planData);
            
            try {
                const user = auth.currentUser;
                if (!user) throw new Error('Usu√°rio n√£o autenticado');
                
                const docData = {
                    ...planData,
                    userId: user.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const docRef = await db.collection('lessonPlans').add(docData);
                console.log('Aula salva com ID:', docRef.id);
                return docRef.id;
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                throw error;
            }
        }

        // Carregar aulas
        async function loadPlans() {
            console.log('Carregando aulas...');
            
            try {
                const user = auth.currentUser;
                if (!user) throw new Error('Usu√°rio n√£o autenticado');
                
                const snapshot = await db.collection('lessonPlans')
                    .where('userId', '==', user.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const plans = [];
                snapshot.forEach(doc => {
                    plans.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('Aulas encontradas:', plans.length);
                
                const contentArea = document.getElementById('contentArea');
                
                if (plans.length === 0) {
                    contentArea.innerHTML = `
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhuma aula encontrada</h3>
                            <p class="text-gray-600">Comece criando sua primeira aula!</p>
                        </div>
                    `;
                } else {
                    contentArea.innerHTML = `
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-4 py-5 sm:p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Minhas Aulas (${plans.length})</h3>
                                <div class="space-y-4">
                                    ${plans.map(plan => `
                                        <div class="border rounded-lg p-4">
                                            <div class="flex justify-between items-start mb-2">
                                                <h4 class="font-medium text-gray-900">${plan.subject} - ${plan.class}</h4>
                                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${plan.duration} aula(s)</span>
                                            </div>
                                            <p class="text-sm text-gray-600">üìÖ ${new Date(plan.date).toLocaleDateString('pt-BR')}</p>
                                            ${plan.habilidade ? `<p class="text-xs text-purple-600 mt-1">üéØ ${plan.habilidade}</p>` : ''}
                                            ${plan.content ? `<p class="text-sm text-gray-700 mt-2">${plan.content}</p>` : ''}
                                            <div class="mt-3 flex space-x-2">
                                                <button onclick="replicateLesson('${plan.id}')" class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded hover:bg-green-200">
                                                    üìã Replicar
                                                </button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Erro ao carregar aulas:', error);
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="text-red-800 font-medium">Erro ao carregar aulas</h3>
                        <p class="text-red-600 text-sm mt-1">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Replicar aula
        async function replicateLesson(lessonId) {
            try {
                const user = auth.currentUser;
                if (!user) throw new Error('Usu√°rio n√£o autenticado');
                
                // Buscar a aula original
                const doc = await db.collection('lessonPlans').doc(lessonId).get();
                if (!doc.exists) throw new Error('Aula n√£o encontrada');
                
                const originalLesson = doc.data();
                
                // Criar nova data (pr√≥ximo dia √∫til)
                const today = new Date();
                const nextDay = new Date(today);
                nextDay.setDate(today.getDate() + 1);
                
                // Criar c√≥pia da aula
                const replicatedLesson = {
                    ...originalLesson,
                    date: nextDay.toISOString().split('T')[0],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                delete replicatedLesson.id;
                
                await db.collection('lessonPlans').add(replicatedLesson);
                
                alert('Aula replicada com sucesso!');
                loadPlans(); // Recarregar lista
                
            } catch (error) {
                console.error('Erro ao replicar aula:', error);
                alert('Erro ao replicar aula: ' + error.message);
            }
        }

        // Logout
        function logout() {
            auth.signOut().then(() => {
                console.log('Usu√°rio deslogado');
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('Erro ao fazer logout:', error);
            });
        }

        // Handler do formul√°rio
        document.getElementById('newPlanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Formul√°rio enviado');
            
            try {
                const formData = new FormData(e.target);
                const planData = {
                    subject: formData.get('subject'),
                    class: formData.get('class'),
                    date: formData.get('date'),
                    duration: formData.get('duration'),
                    habilidade: formData.get('habilidade'),
                    content: formData.get('content')
                };
                
                await saveLessonPlan(planData);
                closeNewPlanModal();
                alert('Aula salva com sucesso!');
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                alert('Erro ao salvar: ' + error.message);
            }
        });
        
        // Inicializar quando a p√°gina carregar
        window.addEventListener('load', initializeFirebase);
        
        console.log('=== SCRIPT CARREGADO ===');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980ae0c466d9f258',t:'MTc1ODEzNTk1Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>


