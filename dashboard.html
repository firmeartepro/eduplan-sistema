<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPlan - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body class="bg-gray-100">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Carregando EduPlan...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">游닄 EduPlan</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userName" class="text-gray-700">Carregando...</span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">
                        Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Welcome Section -->
        <div class="px-4 py-6 sm:px-0">
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Bem-vindo ao EduPlan!</h2>
                    <p class="text-gray-600 mb-6">Seu sistema de planejamento educacional est치 funcionando!</p>
                    
                    <!-- Quick Actions -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="openNewPlanModal()" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">游늶</div>
                            <div class="font-medium">Novo Planejamento</div>
                        </button>
                        
                        <button onclick="loadPlans()" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">游닄</div>
                            <div class="font-medium">Ver Planejamentos</div>
                        </button>
                        
                        <button onclick="showProfile()" class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">游녻</div>
                            <div class="font-medium">Meu Perfil</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div id="contentArea" class="px-4 sm:px-0">
            <!-- Content will be loaded here -->
        </div>
    </main>

    <!-- New Plan Modal -->
    <div id="newPlanModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Novo Planejamento</h3>
                
                <form id="newPlanForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Disciplina</label>
                            <input type="text" name="subject" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Turma</label>
                            <input type="text" name="class" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Data</label>
                            <input type="date" name="date" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Conte칰do</label>
                            <textarea name="content" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border"></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" onclick="closeNewPlanModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/database.js"></script>
    <script src="js/auth.js"></script>

    <script>
        console.log('=== DASHBOARD INICIANDO ===');

        // Initialize dashboard
        firebase.auth().onAuthStateChanged(async function(user) {
            console.log('Auth state changed:', user ? 'logado' : 'n칚o logado');
            
            if (user) {
                try {
                    console.log('Usu치rio logado:', user.email);
                    
                    // Update user name
                    document.getElementById('userName').textContent = user.displayName || user.email;
                    
                    // Hide loading screen
                    document.getElementById('loadingScreen').style.display = 'none';
                    
                    console.log('Dashboard carregado com sucesso!');
                    
                } catch (error) {
                    console.error('Erro ao carregar dashboard:', error);
                    alert('Erro ao carregar dashboard: ' + error.message);
                }
            } else {
                console.log('Usu치rio n칚o logado, redirecionando...');
                window.location.href = 'index.html';
            }
        });

        // Modal functions
        function openNewPlanModal() {
            console.log('Abrindo modal de novo planejamento');
            document.getElementById('newPlanModal').classList.remove('hidden');
        }

        function closeNewPlanModal() {
            console.log('Fechando modal de novo planejamento');
            document.getElementById('newPlanModal').classList.add('hidden');
            document.getElementById('newPlanForm').reset();
        }

        // Form handler
        document.getElementById('newPlanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('=== SALVANDO PLANEJAMENTO ===');
            
            try {
                const formData = new FormData(e.target);
                const planData = {
                    subject: formData.get('subject'),
                    class: formData.get('class'),
                    date: formData.get('date'),
                    content: formData.get('content')
                };
                
                console.log('Dados do formul치rio:', planData);
                
                const planId = await saveLessonPlan(planData);
                console.log('Planejamento salvo com ID:', planId);
                
                closeNewPlanModal();
                alert('Planejamento salvo com sucesso!');
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                alert('Erro ao salvar planejamento: ' + error.message);
            }
        });

        // Load plans function
        async function loadPlans() {
            console.log('=== CARREGANDO PLANEJAMENTOS ===');
            
            try {
                const plans = await getUserLessonPlans();
                console.log('Planejamentos encontrados:', plans);
                
                const contentArea = document.getElementById('contentArea');
                
                if (plans.length === 0) {
                    contentArea.innerHTML = `
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum planejamento encontrado</h3>
                            <p class="text-gray-600">Comece criando seu primeiro planejamento!</p>
                        </div>
                    `;
                } else {
                    contentArea.innerHTML = `
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-4 py-5 sm:p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Meus Planejamentos (${plans.length})</h3>
                                <div class="space-y-4">
                                    ${plans.map(plan => `
                                        <div class="border rounded-lg p-4">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <h4 class="font-medium text-gray-900">${plan.subject} - ${plan.class}</h4>
                                                    <p class="text-sm text-gray-600">Data: ${new Date(plan.date).toLocaleDateString('pt-BR')}</p>
                                                    ${plan.content ? `<p class="text-sm text-gray-700 mt-2">${plan.content}</p>` : ''}
                                                </div>
                                                <span class="text-xs text-gray-500">
                                                    ${plan.createdAt ? new Date(plan.createdAt.toDate()).toLocaleDateString('pt-BR') : ''}
                                                </span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Erro ao carregar planejamentos:', error);
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="text-red-800 font-medium">Erro ao carregar planejamentos</h3>
                        <p class="text-red-600 text-sm mt-1">${error.message}</p>
                    </div>
                `;
            }
        }

        // Show profile function
        function showProfile() {
            console.log('Mostrando perfil');
            const user = firebase.auth().currentUser;
            
            document.getElementById('contentArea').innerHTML = `
                <div class="bg-white rounded-lg shadow">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Meu Perfil</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Nome</label>
                                <p class="mt-1 text-sm text-gray-900">${user.displayName || 'N칚o informado'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Email</label>
                                <p class="mt-1 text-sm text-gray-900">${user.email}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Plano</label>
                                <p class="mt-1 text-sm text-gray-900">Trial (Gratuito)</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        console.log('=== DASHBOARD SCRIPT CARREGADO ===');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980aacb523e7a4e4',t:'MTc1ODEzMzgyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

