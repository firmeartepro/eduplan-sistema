<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPlan - Ensino Fundamental 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Carregando EduPlan...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">📚 EduPlan - Fundamental 1</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userName" class="text-gray-700">Carregando...</span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">
                        Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Planejamento para Ensino Fundamental 1</h2>
                    <p class="text-gray-600 mb-6">Gerencie suas disciplinas e planeje suas aulas conforme a BNCC.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="openDisciplinasModal()" class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">📖</div>
                            <div class="font-medium">Minhas Disciplinas</div>
                        </button>
                        
                        <button onclick="openNewPlanModal()" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">📋</div>
                            <div class="font-medium">Nova Aula</div>
                        </button>
                        
                        <button onclick="loadPlans()" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl mb-2">📚</div>
                            <div class="font-medium">Minhas Aulas</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div id="contentArea" class="px-4 sm:px-0 mt-6">
            <!-- Content will be loaded here -->
        </div>
    </main>

    <!-- Modal Disciplinas -->
    <div id="disciplinasModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full p-6 max-h-96 overflow-y-auto">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Gerenciar Minhas Disciplinas</h3>
                
                <div class="mb-6">
                    <h4 class="font-medium text-gray-700 mb-3">Disciplinas Básicas (BNCC)</h4>
                    <div class="grid grid-cols-2 gap-2" id="disciplinasBasicas">
                        <!-- Será preenchido via JavaScript -->
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="font-medium text-gray-700 mb-3">Disciplinas de Especialistas</h4>
                    <div class="grid grid-cols-2 gap-2" id="disciplinasEspecialistas">
                        <!-- Será preenchido via JavaScript -->
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button onclick="closeDisciplinasModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Plan Modal -->
    <div id="newPlanModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Nova Aula</h3>
                
                <form id="newPlanForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Disciplina</label>
                            <select name="subject" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" id="subjectSelect">
                                <option value="">Selecione uma disciplina</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ano/Turma</label>
                            <select name="class" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                                <option value="">Selecione o ano</option>
                                <option value="1º ano">1º ano</option>
                                <option value="2º ano">2º ano</option>
                                <option value="3º ano">3º ano</option>
                                <option value="4º ano">4º ano</option>
                                <option value="5º ano">5º ano</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Data</label>
                            <input type="date" name="date" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Quantidade de Aulas</label>
                            <select name="duration" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
                                <option value="">Selecione</option>
                                <option value="1">1 hora/aula</option>
                                <option value="2">2 horas/aula</option>
                                <option value="3">3 horas/aula</option>
                                <option value="4">4 horas/aula</option>
                                <option value="5">5 horas/aula</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Habilidades BNCC</label>
                            <select name="habilidade" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border" id="habilidadeSelect">
                                <option value="">Selecione uma habilidade</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Conteúdo/Objetivo</label>
                            <textarea name="content" rows="3" placeholder="Descreva o conteúdo e objetivos da aula..." class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border"></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" onclick="closeNewPlanModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                            Salvar Aula
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts carregados na ordem correta -->
    <script>
        console.log('=== INICIANDO CARREGAMENTO ===');
        
        // Variáveis globais
        let firebase, auth, db;
        
        // Disciplinas da BNCC - Ensino Fundamental 1
        const disciplinasBNCC = {
            basicas: ['Língua Portuguesa', 'Matemática', 'Ciências', 'História', 'Geografia'],
            especialistas: ['Arte', 'Educação Física', 'Informática', 'Inglês']
        };
        
        // Habilidades da BNCC por disciplina (principais códigos)
        const habilidadesBNCC = {
            'Língua Portuguesa': {
                '1º ano': ['EF01LP01 - Reconhecer que textos são lidos e escritos da esquerda para a direita e de cima para baixo da página', 'EF01LP02 - Escrever, espontaneamente ou por ditado, palavras e frases de forma alfabética', 'EF01LP03 - Observar escritas convencionais', 'EF01LP04 - Distinguir as letras do alfabeto de outros sinais gráficos', 'EF01LP05 - Reconhecer o sistema de escrita alfabética como representação dos sons da fala'],
                '2º ano': ['EF02LP01 - Utilizar, ao produzir o texto, grafia correta de palavras conhecidas', 'EF02LP02 - Segmentar palavras em sílabas e remover e substituir sílabas iniciais', 'EF02LP03 - Ler e escrever palavras com correspondências regulares diretas', 'EF02LP04 - Ler e escrever corretamente palavras com sílabas CV, V, CVC, CCV', 'EF02LP05 - Ler e escrever corretamente palavras com marcas de nasalidade'],
                '3º ano': ['EF03LP01 - Ler e escrever palavras com correspondências regulares contextuais', 'EF03LP02 - Ler e escrever corretamente palavras com sílabas CV, V, CVC, CCV, VC, VV, CVV', 'EF03LP03 - Ler e escrever corretamente palavras com os dígrafos lh, nh, ch', 'EF03LP04 - Usar acento gráfico (agudo ou circunflexo) em monossílabos tônicos', 'EF03LP05 - Identificar o número de sílabas de palavras'],
                '4º ano': ['EF04LP01 - Grafar palavras utilizando regras de correspondência fonema-grafema regulares', 'EF04LP02 - Ler e escrever, corretamente, palavras com sílabas VV e CVV em casos nos quais a combinação VV (ditongo) é reduzida na língua oral', 'EF04LP03 - Localizar palavras no dicionário para esclarecer significados', 'EF04LP04 - Usar acento gráfico (agudo ou circunflexo) em paroxítonas terminadas em -i(s), -l, -n, -r, -ão(s)', 'EF04LP05 - Identificar a função na leitura e usar, adequadamente, na escrita ponto final, de interrogação, de exclamação, dois-pontos e travessão'],
                '5º ano': ['EF05LP01 - Grafar palavras utilizando regras de correspondência fonema-grafema regulares, contextuais e morfológicas', 'EF05LP02 - Identificar o caráter polissêmico das palavras (uma mesma palavra com diferentes significados)', 'EF05LP03 - Acentuar corretamente palavras oxítonas, paroxítonas e proparoxítonas', 'EF05LP04 - Diferenciar, na leitura de textos, vírgula, ponto e vírgula, dois-pontos e reconhecer, na leitura de textos, o efeito de sentido que decorre do uso de reticências, aspas, parênteses', 'EF05LP05 - Identificar a expressão de presente, passado e futuro em tempos verbais do modo indicativo']
            },
            'Matemática': {
                '1º ano': ['EF01MA01 - Utilizar números naturais como indicador de quantidade ou de ordem em diferentes situações cotidianas', 'EF01MA02 - Contar de maneira exata ou aproximada, utilizando diferentes estratégias', 'EF01MA03 - Estimar e comparar quantidades de objetos de dois conjuntos', 'EF01MA04 - Contar a quantidade de objetos de coleções até 100 unidades', 'EF01MA05 - Comparar números naturais de até duas ordens em situações cotidianas'],
                '2º ano': ['EF02MA01 - Comparar e ordenar números naturais (até a ordem de centenas)', 'EF02MA02 - Fazer estimativas por meio de estratégias diversas a respeito da quantidade de objetos de coleções', 'EF02MA03 - Comparar quantidades de objetos de dois conjuntos, por estimativa e/ou por correspondência', 'EF02MA04 - Compor e decompor números naturais de até três ordens', 'EF02MA05 - Construir fatos básicos da adição e utilizá-los em procedimentos de cálculo para resolver problemas'],
                '3º ano': ['EF03MA01 - Ler, escrever e comparar números naturais de até a ordem de unidade de milhar', 'EF03MA02 - Identificar características do sistema de numeração decimal', 'EF03MA03 - Construir e utilizar fatos básicos da adição e da subtração para o cálculo mental ou escrito', 'EF03MA04 - Estabelecer a relação entre números naturais e pontos da reta numérica para utilizá-la na ordenação dos números naturais', 'EF03MA05 - Utilizar diferentes procedimentos de cálculo mental e escrito para resolver problemas significativos envolvendo adição e subtração'],
                '4º ano': ['EF04MA01 - Ler, escrever e ordenar números naturais até a ordem de dezenas de milhar', 'EF04MA02 - Mostrar, por decomposição e composição, que todo número natural pode ser escrito por meio de adições e multiplicações por potências de dez', 'EF04MA03 - Resolver e elaborar problemas com números naturais envolvendo adição e subtração', 'EF04MA04 - Utilizar as relações entre adição e subtração, bem como entre multiplicação e divisão, para ampliar as estratégias de cálculo', 'EF04MA05 - Utilizar as propriedades das operações para desenvolver estratégias de cálculo'],
                '5º ano': ['EF05MA01 - Ler, escrever e ordenar números naturais até a ordem das centenas de milhar com compreensão das principais características do sistema de numeração decimal', 'EF05MA02 - Ler, escrever e ordenar números racionais na forma decimal com compreensão das principais características do sistema de numeração decimal', 'EF05MA03 - Identificar e representar frações (menores e maiores que a unidade), associando-as ao resultado de uma divisão ou à ideia de parte de um todo', 'EF05MA04 - Identificar frações equivalentes', 'EF05MA05 - Comparar e ordenar números racionais positivos (representações fracionária e decimal)']
            },
            'Ciências': {
                '1º ano': ['EF01CI01 - Comparar características de diferentes materiais presentes em objetos de uso cotidiano', 'EF01CI02 - Localizar, nomear e representar graficamente (por meio de desenhos) partes do corpo humano', 'EF01CI03 - Discutir as razões pelas quais os hábitos de higiene do corpo são necessários para a manutenção da saúde', 'EF01CI04 - Comparar características físicas entre os colegas, reconhecendo a diversidade e a importância da valorização, do acolhimento e do respeito às diferenças', 'EF01CI05 - Identificar e nomear diferentes escalas de tempo: os períodos diários (manhã, tarde, noite) e a sucessão de dias, semanas, meses e anos'],
                '2º ano': ['EF02CI01 - Identificar de que materiais (metais, madeira, vidro etc.) são feitos os objetos que fazem parte da vida cotidiana', 'EF02CI02 - Propor o uso de diferentes materiais para a construção de objetos de uso cotidiano', 'EF02CI03 - Discutir os cuidados necessários à prevenção de acidentes domésticos (objetos cortantes e inflamáveis, eletricidade, produtos de limpeza, medicamentos etc.)', 'EF02CI04 - Descrever características de plantas e animais (tamanho, forma, cor, fase da vida, local onde se desenvolvem etc.)', 'EF02CI05 - Investigar a importância da água e da luz para a manutenção da vida de plantas em geral'],
                '3º ano': ['EF03CI01 - Produzir diferentes sons a partir da vibração de variados objetos e identificar variáveis que influem nesse fenômeno', 'EF03CI02 - Experimentar e relatar o que ocorre com a passagem da luz através de objetos transparentes (copos, janelas de vidro, lentes, prismas, água etc.), no contato com superfícies polidas (espelhos) e na intersecção com objetos opacos (paredes, pratos, pessoas e outros objetos de uso cotidiano)', 'EF03CI03 - Discutir hábitos necessários para a manutenção da saúde auditiva e visual considerando as condições do ambiente em que vive', 'EF03CI04 - Identificar características sobre o modo de vida (o que comem, como se reproduzem, como se deslocam etc.) dos animais mais comuns no ambiente próximo', 'EF03CI05 - Descrever e comunicar as alterações que ocorrem desde o nascimento em animais de diferentes meios terrestres ou aquáticos, inclusive o homem'],
                '4º ano': ['EF04CI01 - Identificar misturas na vida diária, com base em suas propriedades físicas observáveis', 'EF04CI02 - Testar e relatar transformações nos materiais do dia a dia quando expostos a diferentes condições (aquecimento, resfriamento, luz e umidade)', 'EF04CI03 - Concluir que algumas mudanças causadas por aquecimento ou resfriamento são reversíveis (como as mudanças de estado físico da água) e outras não (como o cozimento do ovo, a queima do papel etc.)', 'EF04CI04 - Analisar e construir cadeias alimentares simples, reconhecendo a posição ocupada pelos seres vivos nessas cadeias e o papel do Sol como fonte primária de energia na produção de alimentos', 'EF04CI05 - Descrever e destacar semelhanças e diferenças entre o ciclo da matéria e o fluxo de energia entre os componentes vivos e não vivos de um ecossistema'],
                '5º ano': ['EF05CI01 - Explorar fenômenos da vida cotidiana que evidenciem propriedades físicas dos materiais – como densidade, condutibilidade térmica e elétrica, magnetismo, dureza, elasticidade etc.', 'EF05CI02 - Aplicar os conhecimentos sobre as mudanças de estado físico da água para explicar o ciclo hidrológico', 'EF05CI03 - Selecionar argumentos que justifiquem a importância da cobertura vegetal para a manutenção do ciclo da água, a conservação dos solos, dos cursos de água e da qualidade do ar atmosférico', 'EF05CI04 - Identificar os principais usos da água e de outros materiais nas atividades cotidianas para discutir e propor formas sustentáveis de utilização desses recursos', 'EF05CI05 - Construir propostas coletivas para um consumo mais consciente e criar soluções tecnológicas para o descarte adequado e a reutilização ou reciclagem de materiais consumidos na escola e/ou na vida cotidiana']
            },
            'História': {
                '1º ano': ['EF01HI01 - Identificar aspectos do seu crescimento por meio do registro das lembranças particulares ou de lembranças dos membros de sua família e/ou de sua comunidade', 'EF01HI02 - Identificar a relação entre as suas histórias e as histórias de sua família e de sua comunidade', 'EF01HI03 - Descrever e distinguir os seus papéis e responsabilidades relacionados à família, à escola e à comunidade', 'EF01HI04 - Identificar as diferenças entre os variados ambientes em que vive (doméstico, escolar e da comunidade), reconhecendo as especificidades dos hábitos e das regras que os regem', 'EF01HI05 - Identificar semelhanças e diferenças entre jogos e brincadeiras atuais e de outras épocas e lugares'],
                '2º ano': ['EF02HI01 - Reconhecer espaços de sociabilidade e identificar os motivos que aproximam e separam as pessoas em diferentes grupos sociais ou de parentesco', 'EF02HI02 - Identificar e descrever práticas e papéis sociais que as pessoas exercem em diferentes comunidades', 'EF02HI03 - Selecionar situações cotidianas que remetam à percepção de mudança, pertencimento e memória', 'EF02HI04 - Selecionar e compreender o significado de objetos e documentos pessoais como fontes de memórias e histórias nos âmbitos pessoal, familiar, escolar e comunitário', 'EF02HI05 - Selecionar objetos e documentos pessoais e de grupos próximos ao seu convívio e compreender sua função, seu uso e seu significado'],
                '3º ano': ['EF03HI01 - Identificar os grupos populacionais que formam a cidade, o município e a região, as relações estabelecidas entre eles e os eventos que marcam a formação da cidade', 'EF03HI02 - Selecionar, por meio da consulta de fontes de diferentes naturezas, e registrar acontecimentos ocorridos ao longo do tempo na cidade ou região em que vive', 'EF03HI03 - Identificar e comparar pontos de vista em relação a eventos significativos do local em que vive, aspectos relacionados a condições sociais e à presença de diferentes grupos sociais e culturais', 'EF03HI04 - Identificar os patrimônios históricos e culturais de sua cidade ou região e discutir as razões culturais, sociais e políticas para que assim sejam considerados', 'EF03HI05 - Identificar os marcos históricos do lugar em que vive e compreender seus significados'],
                '4º ano': ['EF04HI01 - Reconhecer a história como resultado da ação do ser humano no tempo e no espaço, com base na identificação de mudanças e permanências ao longo do tempo', 'EF04HI02 - Identificar mudanças e permanências ao longo do tempo, discutindo os sentidos dos grandes marcos da história da humanidade', 'EF04HI03 - Identificar as transformações ocorridas na cidade ao longo do tempo e discutir suas interferências nos modos de vida de seus habitantes', 'EF04HI04 - Identificar as relações entre os indivíduos e a natureza e discutir o significado do nomadismo e da fixação das primeiras comunidades humanas', 'EF04HI05 - Relacionar os processos de ocupação do campo a intervenções na natureza, avaliando os resultados dessas intervenções'],
                '5º ano': ['EF05HI01 - Identificar os processos de formação das culturas e dos povos, relacionando-os com o espaço geográfico ocupado', 'EF05HI02 - Identificar os mecanismos de organização do poder político com vistas à compreensão da ideia de Estado e/ou de outras formas de ordenação social', 'EF05HI03 - Analisar o papel das culturas e das religiões na composição identitária dos povos antigos', 'EF05HI04 - Associar a noção de cidadania com os princípios de respeito à diversidade, à pluralidade e aos direitos humanos', 'EF05HI05 - Associar o conceito de cidadania à conquista de direitos dos povos e das sociedades, compreendendo-o como conquista histórica']
            },
            'Geografia': {
                '1º ano': ['EF01GE01 - Descrever características observadas de seus lugares de vivência (moradia, escola etc.) e identificar semelhanças e diferenças entre esses lugares', 'EF01GE02 - Identificar semelhanças e diferenças entre jogos e brincadeiras de diferentes épocas e lugares', 'EF01GE03 - Identificar e relatar semelhanças e diferenças de usos do espaço público (praças, parques) para o lazer e diferentes manifestações', 'EF01GE04 - Discutir e elaborar, coletivamente, regras de convívio em diferentes espaços (sala de aula, escola etc.)', 'EF01GE05 - Observar e descrever ritmos naturais (dia e noite, variação de temperatura e umidade etc.) em diferentes escalas espaciais e temporais'],
                '2º ano': ['EF02GE01 - Descrever a história das migrações no bairro ou comunidade em que vive', 'EF02GE02 - Comparar costumes e tradições de diferentes populações inseridas no bairro ou comunidade em que vive', 'EF02GE03 - Comparar diferentes meios de transporte e de comunicação, indicando o seu papel na conexão entre lugares', 'EF02GE04 - Reconhecer semelhanças e diferenças nos hábitos, nas relações com a natureza e no modo de viver de pessoas em diferentes lugares', 'EF02GE05 - Analisar mudanças de paisagens urbanas ao longo do tempo, comparando imagens de um mesmo lugar em diferentes momentos'],
                '3º ano': ['EF03GE01 - Identificar e comparar aspectos culturais dos grupos sociais de seus lugares de vivência', 'EF03GE02 - Identificar, em seus lugares de vivência, marcas de contribuição cultural e econômica de grupos de diferentes origens', 'EF03GE03 - Reconhecer os diferentes modos de vida de povos e comunidades tradicionais em distintos lugares', 'EF03GE04 - Explicar como os processos naturais e históricos atuam na formação e na mudança das paisagens naturais e antrópicas nos seus lugares de vivência', 'EF03GE05 - Identificar alimentos, minerais e outros produtos cultivados e extraídos da natureza, comparando as atividades de trabalho em diferentes lugares'],
                '4º ano': ['EF04GE01 - Selecionar, em seus lugares de vivência e em suas histórias familiares, elementos de distintas culturas (indígenas, afro-brasileiras, de outras regiões do país, latino-americanas, europeias, asiáticas etc.)', 'EF04GE02 - Descrever processos migratórios e suas contribuições para a formação da sociedade brasileira', 'EF04GE03 - Distinguir funções e papéis dos órgãos do poder público e canais de participação social na gestão do Município', 'EF04GE04 - Reconhecer especificidades e analisar a interdependência do campo e da cidade, considerando fluxos econômicos, de informações, de ideias e de pessoas', 'EF04GE05 - Distinguir unidades político-administrativas oficiais nacionais (Distrito, Município, Unidade da Federação e grande região), suas fronteiras e sua hierarquia'],
                '5º ano': ['EF05GE01 - Descrever e analisar dinâmicas populacionais na Unidade da Federação em que vive, estabelecendo relações entre migrações e condições de infraestrutura', 'EF05GE02 - Identificar diferenças étnico-raciais e étnico-culturais e desigualdades sociais entre grupos em diferentes territórios', 'EF05GE03 - Identificar as formas e funções das cidades e analisar as mudanças sociais, econômicas e ambientais provocadas pelo seu crescimento', 'EF05GE04 - Reconhecer as características da cidade e analisar as interações entre a cidade e o campo e entre cidades na rede urbana', 'EF05GE05 - Identificar e comparar as mudanças dos tipos de trabalho e desenvolvimento tecnológico na agropecuária, na indústria, no comércio e nos serviços']
            },
            'Arte': {
                '1º ano': ['EF01AR01 - Identificar e apreciar formas distintas das artes visuais tradicionais e contemporâneas', 'EF01AR02 - Explorar e reconhecer elementos constitutivos das artes visuais (ponto, linha, forma, cor, espaço, movimento etc.)', 'EF01AR03 - Reconhecer e analisar a influência de distintas matrizes estéticas e culturais das artes visuais nas manifestações artísticas das culturas locais, regionais e nacionais', 'EF01AR04 - Experimentar diferentes formas de expressão artística (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instalação, vídeo, fotografia etc.)', 'EF01AR05 - Experimentar a criação em artes visuais de modo individual, coletivo e colaborativo'],
                '2º ano': ['EF02AR01 - Reconhecer e apreciar formas distintas das artes visuais tradicionais e contemporâneas', 'EF02AR02 - Explorar e reconhecer elementos constitutivos das artes visuais (ponto, linha, forma, cor, espaço, movimento etc.)', 'EF02AR03 - Reconhecer e analisar a influência de distintas matrizes estéticas e culturais das artes visuais nas manifestações artísticas das culturas locais, regionais e nacionais', 'EF02AR04 - Experimentar diferentes formas de expressão artística (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instalação, vídeo, fotografia etc.)', 'EF02AR05 - Experimentar a criação em artes visuais de modo individual, coletivo e colaborativo'],
                '3º ano': ['EF03AR01 - Identificar e apreciar formas distintas das artes visuais tradicionais e contemporâneas', 'EF03AR02 - Identificar e analisar elementos constitutivos das artes visuais (ponto, linha, forma, cor, espaço, movimento etc.)', 'EF03AR03 - Reconhecer e analisar a influência de distintas matrizes estéticas e culturais das artes visuais nas manifestações artísticas das culturas locais, regionais e nacionais', 'EF03AR04 - Experimentar diferentes formas de expressão artística (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instalação, vídeo, fotografia etc.)', 'EF03AR05 - Experimentar a criação em artes visuais de modo individual, coletivo e colaborativo'],
                '4º ano': ['EF04AR01 - Identificar e apreciar formas distintas das artes visuais tradicionais e contemporâneas', 'EF04AR02 - Identificar e analisar elementos constitutivos das artes visuais (ponto, linha, forma, cor, espaço, movimento etc.)', 'EF04AR03 - Reconhecer e analisar a influência de distintas matrizes estéticas e culturais das artes visuais nas manifestações artísticas das culturas locais, regionais e nacionais', 'EF04AR04 - Experimentar diferentes formas de expressão artística (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instalação, vídeo, fotografia etc.)', 'EF04AR05 - Experimentar a criação em artes visuais de modo individual, coletivo e colaborativo'],
                '5º ano': ['EF05AR01 - Identificar e apreciar formas distintas das artes visuais tradicionais e contemporâneas', 'EF05AR02 - Identificar e analisar elementos constitutivos das artes visuais (ponto, linha, forma, cor, espaço, movimento etc.)', 'EF05AR03 - Reconhecer e analisar a influência de distintas matrizes estéticas e culturais das artes visuais nas manifestações artísticas das culturas locais, regionais e nacionais', 'EF05AR04 - Experimentar diferentes formas de expressão artística (desenho, pintura, colagem, quadrinhos, dobradura, escultura, modelagem, instalação, vídeo, fotografia etc.)', 'EF05AR05 - Experimentar a criação em artes visuais de modo individual, coletivo e colaborativo']
            },
            'Educação Física': {
                '1º ano': ['EF01EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunitário e regional', 'EF01EF02 - Explicar, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunitário e regional', 'EF01EF03 - Descrever, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz indígena e africana', 'EF01EF04 - Colaborar na proposição e na produção de alternativas para a prática, em outros momentos e espaços, de brincadeiras e jogos e demais práticas corporais tematizadas na escola', 'EF01EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a prática de esportes de marca e de precisão'],
                '2º ano': ['EF02EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunitário e regional', 'EF02EF02 - Explicar, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunitário e regional', 'EF02EF03 - Descrever, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz indígena e africana', 'EF02EF04 - Colaborar na proposição e na produção de alternativas para a prática, em outros momentos e espaços, de brincadeiras e jogos e demais práticas corporais tematizadas na escola', 'EF02EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a prática de esportes de marca e de precisão'],
                '3º ano': ['EF03EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunitário e regional', 'EF03EF02 - Explicar, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunitário e regional', 'EF03EF03 - Descrever, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz indígena e africana', 'EF03EF04 - Colaborar na proposição e na produção de alternativas para a prática, em outros momentos e espaços, de brincadeiras e jogos e demais práticas corporais tematizadas na escola', 'EF03EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a prática de esportes de marca e de precisão'],
                '4º ano': ['EF04EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunitário e regional', 'EF04EF02 - Explicar, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunitário e regional', 'EF04EF03 - Descrever, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz indígena e africana', 'EF04EF04 - Colaborar na proposição e na produção de alternativas para a prática, em outros momentos e espaços, de brincadeiras e jogos e demais práticas corporais tematizadas na escola', 'EF04EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a prática de esportes de marca e de precisão'],
                '5º ano': ['EF05EF01 - Experimentar, fruir e recriar diferentes brincadeiras e jogos da cultura popular presentes no contexto comunitário e regional', 'EF05EF02 - Explicar, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do contexto comunitário e regional', 'EF05EF03 - Descrever, por meio de múltiplas linguagens (corporal, visual, oral e escrita), as brincadeiras e os jogos populares do Brasil e de matriz indígena e africana', 'EF05EF04 - Colaborar na proposição e na produção de alternativas para a prática, em outros momentos e espaços, de brincadeiras e jogos e demais práticas corporais tematizadas na escola', 'EF05EF05 - Experimentar e fruir prezando pelo trabalho coletivo e pelo protagonismo, a prática de esportes de marca e de precisão']
            },
            'Inglês': {
                '1º ano': ['EF01LI01 - Interagir por meio de cumprimentos, utilizando a língua inglesa para se comunicar', 'EF01LI02 - Conhecer a si e ao outro por meio de repertório relativo a dados pessoais', 'EF01LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informações do contexto escolar', 'EF01LI04 - Reconhecer o inglês como língua franca, identificando o seu uso no cotidiano', 'EF01LI05 - Conhecer diferentes países que têm o inglês como língua materna e/ou oficial'],
                '2º ano': ['EF02LI01 - Interagir por meio de cumprimentos, utilizando a língua inglesa para se comunicar', 'EF02LI02 - Conhecer a si e ao outro por meio de repertório relativo a dados pessoais', 'EF02LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informações do contexto escolar', 'EF02LI04 - Reconhecer o inglês como língua franca, identificando o seu uso no cotidiano', 'EF02LI05 - Conhecer diferentes países que têm o inglês como língua materna e/ou oficial'],
                '3º ano': ['EF03LI01 - Cumprimentar, apresentar-se e despedir-se, utilizando a língua inglesa para se comunicar', 'EF03LI02 - Coletar informações do grupo, perguntando e respondendo sobre a família, os amigos, a escola e a comunidade', 'EF03LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informações do contexto escolar', 'EF03LI04 - Reconhecer o inglês como língua franca, identificando o seu uso no cotidiano', 'EF03LI05 - Conhecer diferentes países que têm o inglês como língua materna e/ou oficial'],
                '4º ano': ['EF04LI01 - Cumprimentar, apresentar-se e despedir-se, utilizando a língua inglesa para se comunicar', 'EF04LI02 - Coletar informações do grupo, perguntando e respondendo sobre a família, os amigos, a escola e a comunidade', 'EF04LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informações do contexto escolar', 'EF04LI04 - Reconhecer o inglês como língua franca, identificando o seu uso no cotidiano', 'EF04LI05 - Conhecer diferentes países que têm o inglês como língua materna e/ou oficial'],
                '5º ano': ['EF05LI01 - Participar de conversas, utilizando estratégias para se fazer entender', 'EF05LI02 - Coletar informações do grupo, perguntando e respondendo sobre a família, os amigos, a escola e a comunidade', 'EF05LI03 - Interagir com o professor e os colegas, utilizando cumprimentos, dados pessoais e informações do contexto escolar', 'EF05LI04 - Reconhecer o inglês como língua franca, identificando o seu uso no cotidiano', 'EF05LI05 - Conhecer diferentes países que têm o inglês como língua materna e/ou oficial']
            },
            'Informática': {
                '1º ano': ['Conceitos básicos de informática', 'Uso correto do mouse e teclado', 'Desenho e pintura digital', 'Jogos educativos simples', 'Cuidados com equipamentos'],
                '2º ano': ['Navegação básica em programas', 'Criação de textos simples', 'Uso de programas educativos', 'Pesquisa orientada na internet', 'Segurança digital básica'],
                '3º ano': ['Editor de texto básico', 'Apresentações simples', 'Internet segura', 'Projetos digitais colaborativos', 'Organização de arquivos'],
                '4º ano': ['Planilhas básicas', 'Pesquisa e seleção de informações', 'Criação de conteúdo digital', 'Pensamento computacional', 'Ética digital'],
                '5º ano': ['Programação básica (Scratch)', 'Projetos multimídia', 'Cidadania digital', 'Resolução de problemas com tecnologia', 'Inovação e criatividade digital']
            }
        };
        
        // Função para carregar scripts em ordem
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Carregar Firebase em ordem
        async function initializeFirebase() {
            try {
                console.log('1. Carregando Firebase App...');
                await loadScript('https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js');
                
                console.log('2. Carregando Firebase Auth...');
                await loadScript('https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js');
                
                console.log('3. Carregando Firebase Firestore...');
                await loadScript('https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js');
                
                console.log('4. Inicializando Firebase...');
                const firebaseConfig = {
                    apiKey: "AIzaSyBqJJcT8fX9wLqKoOoN8pMzQvGxHjKjY8E",
                    authDomain: "eduplan-b5d94.firebaseapp.com",
                    projectId: "eduplan-b5d94",
                    storageBucket: "eduplan-b5d94.firebasestorage.app",
                    messagingSenderId: "590470983307",
                    appId: "1:590470983307:web:7c8a4b5d9e2f1a3b4c5d6e"
                };
                
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                console.log('5. Firebase inicializado com sucesso!');
                
                // Configurar observer de autenticação
                auth.onAuthStateChanged(function(user) {
                    console.log('Auth state changed:', user ? 'logado' : 'não logado');
                    
                    if (user) {
                        console.log('Usuário logado:', user.email);
                        console.log('Display Name:', user.displayName);
                        console.log('Todos os dados do usuário:', user);
                        
                        // Usar o nome real do Firebase ou email como fallback
                        const userName = user.displayName || user.email.split('@')[0];
                        document.getElementById('userName').textContent = userName;
                        document.getElementById('loadingScreen').style.display = 'none';
                        
                        // Carregar disciplinas do usuário
                        loadUserSubjects();
                    } else {
                        console.log('Usuário não logado, redirecionando...');
                        window.location.href = 'index.html';
                    }
                });
                
            } catch (error) {
                console.error('Erro ao carregar Firebase:', error);
                document.getElementById('loadingScreen').innerHTML = `
                    <div class="text-center">
                        <div class="text-red-500 text-4xl mb-4">❌</div>
                        <p class="text-red-600">Erro ao carregar Firebase</p>
                        <button onclick="location.reload()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded">
                            Tentar novamente
                        </button>
                    </div>
                `;
            }
        }
        
        // Carregar disciplinas do usuário
        async function loadUserSubjects() {
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                const doc = await db.collection('userSubjects').doc(user.uid).get();
                let userSubjects = [];
                
                if (doc.exists) {
                    userSubjects = doc.data().subjects || [];
                }
                
                // Atualizar select de disciplinas no formulário
                updateSubjectSelect(userSubjects);
                
            } catch (error) {
                console.error('Erro ao carregar disciplinas:', error);
            }
        }
        
        // Atualizar select de disciplinas
        function updateSubjectSelect(userSubjects) {
            const select = document.getElementById('subjectSelect');
            select.innerHTML = '<option value="">Selecione uma disciplina</option>';
            
            userSubjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                select.appendChild(option);
            });
        }
        
        // Modal de disciplinas
        function openDisciplinasModal() {
            console.log('Abrindo modal de disciplinas');
            loadDisciplinasModal();
            document.getElementById('disciplinasModal').classList.remove('hidden');
        }

        function closeDisciplinasModal() {
            console.log('Fechando modal de disciplinas');
            document.getElementById('disciplinasModal').classList.add('hidden');
        }
        
        // Carregar disciplinas no modal
        async function loadDisciplinasModal() {
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                // Buscar disciplinas do usuário
                const doc = await db.collection('userSubjects').doc(user.uid).get();
                let userSubjects = [];
                
                if (doc.exists) {
                    userSubjects = doc.data().subjects || [];
                }
                
                // Preencher disciplinas básicas
                const basicasContainer = document.getElementById('disciplinasBasicas');
                basicasContainer.innerHTML = '';
                
                disciplinasBNCC.basicas.forEach(disciplina => {
                    const isSelected = userSubjects.includes(disciplina);
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <label class="flex items-center space-x-2 p-2 border rounded ${isSelected ? 'bg-blue-50 border-blue-300' : 'border-gray-300'}">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSubject('${disciplina}')" class="rounded">
                            <span class="text-sm">${disciplina}</span>
                        </label>
                    `;
                    basicasContainer.appendChild(div);
                });
                
                // Preencher disciplinas de especialistas
                const especialistasContainer = document.getElementById('disciplinasEspecialistas');
                especialistasContainer.innerHTML = '';
                
                disciplinasBNCC.especialistas.forEach(disciplina => {
                    const isSelected = userSubjects.includes(disciplina);
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <label class="flex items-center space-x-2 p-2 border rounded ${isSelected ? 'bg-blue-50 border-blue-300' : 'border-gray-300'}">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSubject('${disciplina}')" class="rounded">
                            <span class="text-sm">${disciplina}</span>
                        </label>
                    `;
                    especialistasContainer.appendChild(div);
                });
                
            } catch (error) {
                console.error('Erro ao carregar disciplinas do modal:', error);
            }
        }
        
        // Toggle disciplina
        async function toggleSubject(disciplina) {
            try {
                const user = auth.currentUser;
                if (!user) return;
                
                // Buscar disciplinas atuais
                const doc = await db.collection('userSubjects').doc(user.uid).get();
                let userSubjects = [];
                
                if (doc.exists) {
                    userSubjects = doc.data().subjects || [];
                }
                
                // Toggle disciplina
                if (userSubjects.includes(disciplina)) {
                    userSubjects = userSubjects.filter(s => s !== disciplina);
                } else {
                    userSubjects.push(disciplina);
                }
                
                // Salvar no Firebase
                await db.collection('userSubjects').doc(user.uid).set({
                    subjects: userSubjects,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Atualizar select do formulário
                updateSubjectSelect(userSubjects);
                
                console.log('Disciplinas atualizadas:', userSubjects);
                
            } catch (error) {
                console.error('Erro ao atualizar disciplina:', error);
                alert('Erro ao atualizar disciplina: ' + error.message);
            }
        }
        
        // Modal de nova aula
        function openNewPlanModal() {
            console.log('Abrindo modal de nova aula');
            document.getElementById('newPlanModal').classList.remove('hidden');
        }

        function closeNewPlanModal() {
            console.log('Fechando modal de nova aula');
            document.getElementById('newPlanModal').classList.add('hidden');
            document.getElementById('newPlanForm').reset();
            document.getElementById('habilidadeSelect').innerHTML = '<option value="">Selecione uma habilidade</option>';
        }
        
        // Atualizar habilidades quando disciplina ou ano mudar
        document.addEventListener('DOMContentLoaded', function() {
            const subjectSelect = document.getElementById('subjectSelect');
            const classSelect = document.querySelector('select[name="class"]');
            const habilidadeSelect = document.getElementById('habilidadeSelect');
            
            function updateHabilidades() {
                const subject = subjectSelect.value;
                const classYear = classSelect.value;
                
                habilidadeSelect.innerHTML = '<option value="">Selecione uma habilidade</option>';
                
                if (subject && classYear && habilidadesBNCC[subject] && habilidadesBNCC[subject][classYear]) {
                    habilidadesBNCC[subject][classYear].forEach(habilidade => {
                        const option = document.createElement('option');
                        option.value = habilidade;
                        option.textContent = habilidade;
                        habilidadeSelect.appendChild(option);
                    });
                }
            }
            
            if (subjectSelect && classSelect) {
                subjectSelect.addEventListener('change', updateHabilidades);
                classSelect.addEventListener('change', updateHabilidades);
            }
        });

        // Salvar aula
        async function saveLessonPlan(planData) {
            console.log('Salvando aula:', planData);
            
            try {
                const user = auth.currentUser;
                if (!user) throw new Error('Usuário não autenticado');
                
                const docData = {
                    ...planData,
                    userId: user.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const docRef = await db.collection('lessonPlans').add(docData);
                console.log('Aula salva com ID:', docRef.id);
                return docRef.id;
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                throw error;
            }
        }

        // Carregar aulas
        async function loadPlans() {
            console.log('Carregando aulas...');
            
            try {
                const user = auth.currentUser;
                if (!user) throw new Error('Usuário não autenticado');
                
                const snapshot = await db.collection('lessonPlans')
                    .where('userId', '==', user.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const plans = [];
                snapshot.forEach(doc => {
                    plans.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('Aulas encontradas:', plans.length);
                
                const contentArea = document.getElementById('contentArea');
                
                if (plans.length === 0) {
                    contentArea.innerHTML = `
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhuma aula encontrada</h3>
                            <p class="text-gray-600">Comece criando sua primeira aula!</p>
                        </div>
                    `;
                } else {
                    contentArea.innerHTML = `
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-4 py-5 sm:p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Minhas Aulas (${plans.length})</h3>
                                <div class="space-y-4">
                                    ${plans.map(plan => `
                                        <div class="border rounded-lg p-4">
                                            <div class="flex justify-between items-start mb-2">
                                                <h4 class="font-medium text-gray-900">${plan.subject} - ${plan.class}</h4>
                                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${plan.duration} aula(s)</span>
                                            </div>
                                            <p class="text-sm text-gray-600">📅 ${new Date(plan.date).toLocaleDateString('pt-BR')}</p>
                                            ${plan.habilidade ? `<p class="text-xs text-purple-600 mt-1">🎯 ${plan.habilidade}</p>` : ''}
                                            ${plan.content ? `<p class="text-sm text-gray-700 mt-2">${plan.content}</p>` : ''}
                                            <div class="mt-3 flex space-x-2">
                                                <button onclick="replicateLesson('${plan.id}')" class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded hover:bg-green-200">
                                                    📋 Replicar
                                                </button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Erro ao carregar aulas:', error);
                document.getElementById('contentArea').innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="text-red-800 font-medium">Erro ao carregar aulas</h3>
                        <p class="text-red-600 text-sm mt-1">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Replicar aula
        async function replicateLesson(lessonId) {
            try {
                const user = auth.currentUser;
                if (!user) throw new Error('Usuário não autenticado');
                
                // Buscar a aula original
                const doc = await db.collection('lessonPlans').doc(lessonId).get();
                if (!doc.exists) throw new Error('Aula não encontrada');
                
                const originalLesson = doc.data();
                
                // Criar nova data (próximo dia útil)
                const today = new Date();
                const nextDay = new Date(today);
                nextDay.setDate(today.getDate() + 1);
                
                // Criar cópia da aula
                const replicatedLesson = {
                    ...originalLesson,
                    date: nextDay.toISOString().split('T')[0],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                delete replicatedLesson.id;
                
                await db.collection('lessonPlans').add(replicatedLesson);
                
                alert('Aula replicada com sucesso!');
                loadPlans(); // Recarregar lista
                
            } catch (error) {
                console.error('Erro ao replicar aula:', error);
                alert('Erro ao replicar aula: ' + error.message);
            }
        }

        // Logout
        function logout() {
            auth.signOut().then(() => {
                console.log('Usuário deslogado');
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('Erro ao fazer logout:', error);
            });
        }

        // Handler do formulário
        document.getElementById('newPlanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Formulário enviado');
            
            try {
                const formData = new FormData(e.target);
                const planData = {
                    subject: formData.get('subject'),
                    class: formData.get('class'),
                    date: formData.get('date'),
                    duration: formData.get('duration'),
                    habilidade: formData.get('habilidade'),
                    content: formData.get('content')
                };
                
                await saveLessonPlan(planData);
                closeNewPlanModal();
                alert('Aula salva com sucesso!');
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                alert('Erro ao salvar: ' + error.message);
            }
        });
        
        // Inicializar quando a página carregar
        window.addEventListener('load', initializeFirebase);
        
        console.log('=== SCRIPT CARREGADO ===');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980ae0c466d9f258',t:'MTc1ODEzNTk1Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>


